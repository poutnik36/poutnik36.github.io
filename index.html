<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Opakov√°n√≠ slov√≠ƒçek ‚Äì Mini aplikace</title>
  <meta name="description" content="Lehk√° webov√° aplikace pro opakov√°n√≠ anglick√Ωch slov√≠ƒçek podle lekc√≠. ƒåte slov√≠ƒçka z CSV souboru." />
  <style>
    :root{
      --bg:#0b1020; --card:#121832; --text:#e8eefc; --muted:#9aa6c8; --acc:#7aa2ff; --border:#243055; --good:#16a34a; --bad:#ef4444; --warn:#f59e0b;
    }
    [data-theme="light"]{
      --bg:#f8fafc; --card:#ffffff; --text:#0b1020; --muted:#475569; --acc:#1d4ed8; --border:#e2e8f0; --good:#16a34a; --bad:#b91c1c; --warn:#b45309;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:var(--bg); color:var(--text)}
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.2) blur(8px); background:color-mix(in oklab, var(--bg) 85%, transparent); border-bottom:1px solid var(--border)}
    .wrap{max-width:1000px; margin-inline:auto; padding:1rem}
    nav{display:flex; align-items:center; justify-content:space-between}
    .btn{display:inline-flex; align-items:center; gap:.5rem; padding:.55rem .9rem; border:1px solid var(--border); background:var(--card); color:var(--text); border-radius:.8rem; cursor:pointer}
    .btn:hover{transform:translateY(-1px)}
    .btn.secondary{background:transparent}
    .grid{display:grid; gap:1rem}
    @media(min-width:1000px){.grid{grid-template-columns:2fr 1fr}}
    .card{background:var(--card); border:1px solid var(--border); border-radius:1rem; padding:1rem}
    h2{margin:0 0 .5rem; font-size:1.25rem}
    label{display:block; font-weight:600; margin:.4rem 0 .2rem}
    input[type="text"], input[type="number"], select{width:100%; padding:.6rem .7rem; border-radius:.6rem; border:1px solid var(--border); background:var(--bg); color:var(--text)}
    .row{display:flex; gap:.5rem; align-items:center}
    .row.wrap{flex-wrap:wrap}
    .row > *{flex:1}
    .pill{border:1px solid var(--border); border-radius:999px; padding:.2rem .6rem; color:var(--muted); font-size:.85rem}
    .muted{color:var(--muted)}
    .result{margin-top:.6rem; font-weight:700}
    .good{color:var(--good)}
    .bad{color:var(--bad)}
    .warn{color:var(--warn)}
    .flex{display:flex; gap:.6rem; align-items:center}
    .space{height:1rem}
    .badge{display:inline-flex; gap:.35rem; align-items:center; padding:.2rem .5rem; border:1px solid var(--border); border-radius:.6rem; font-size:.85rem; color:var(--muted)}
    .checkboxes{display:grid; grid-template-columns:repeat(auto-fill, minmax(48px,1fr)); gap:.4rem}
    .dim{opacity:.7}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <nav>
        <div class="flex">
          <strong>Angliƒçtina pro policejn√≠ praxi - slov√≠ƒçka</strong>
          <span class="pill" id="countInfo">0 slov</span>
          <span class="pill" id="filterInfo" title="Filtrovan√Ω poƒçet">0 vybr√°no</span>
          <span class="pill" id="dataInfo" title="Zdroj dat">CSV</span>
        </div>
        <div class="flex">
          <button class="btn secondary" id="themeBtn" title="Svƒõtl√Ω/tmav√Ω re≈æim">üåì Motiv</button>
        </div>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="grid" id="top">
      <div class="card" id="settings">
        <h2>Nastaven√≠</h2>
        <div class="row">
          <div>
            <label for="direction">Smƒõr</label>
            <select id="direction">
              <option value="en-cs">EN ‚Üí CZ</option>
              <option value="cs-en">CZ ‚Üí EN</option>
              <option value="mix">Mix</option>
            </select>
          </div>
          <div>
            <label for="mode">Re≈æim</label>
            <select id="mode">
              <option value="random">N√°hodnƒõ</option>
              <option value="weak">Up≈ôednostnit slab√°</option>
            </select>
          </div>
        </div>

        <div class="space"></div>
        <label>Lekce</label>
        <div class="checkboxes" id="lessonsBox" aria-label="V√Ωbƒõr lekc√≠"></div>
        <div class="row" style="margin-top:.4rem">
          <button class="btn secondary" id="selectAllBtn">Vybrat v≈°e</button>
          <button class="btn secondary" id="clearAllBtn">Zru≈°it v≈°e</button>
        </div>

        <div class="space"></div>
        <div class="row">
          <div>
            <label for="targetCount">Poƒçet slov√≠ƒçek (c√≠l sezen√≠)</label>
            <input id="targetCount" type="number" min="1" step="1" value="20" />
          </div>
          <div>
            <label class="row" style="gap:.6rem"><input id="timed" type="checkbox" /> Uƒçen√≠ na ƒças</label>
            <div class="row">
              <input id="timeLimit" type="number" min="1" step="1" value="10" />
              <span class="badge">min</span>
            </div>
          </div>
        </div>

        <div class="space"></div>
        <div class="flex">
          <button class="btn" id="startBtn">‚ñ∂Ô∏è Start</button>
          <button class="btn secondary" id="resetBtn">‚Ü∫ Reset</button>
          <span class="badge" id="sessionInfo">Neaktivn√≠</span>
          <span class="badge" id="timerInfo" hidden>‚è± 00:00</span>
        </div>
      </div>

      <aside class="card dim" id="summaryTop" aria-hidden="true">
        <h2>Souhrn (≈æivƒõ)</h2>
        <div class="muted">Sezen√≠</div>
        <div class="flex">
          <span class="pill">Spr√°vnƒõ: <strong id="okToday">0</strong></span>
          <span class="pill">≈†patnƒõ: <strong id="badToday">0</strong></span>
          <span class="pill">Zb√Ωv√°: <strong id="leftToday">0</strong></span>
        </div>
        <div class="space"></div>
        <div class="muted">Celkem</div>
        <div class="flex">
          <span class="pill">Pokusy: <strong id="attemptsAll">0</strong></span>
          <span class="pill">√öspƒõ≈°nost: <strong id="accuracyAll">0%</strong></span>
        </div>
      </aside>
    </section>

    <section class="card" id="practice" style="margin-top:1rem">
      <h2>Tr√©nink</h2>
      <div class="muted" id="promptMeta">Vyber lekce a spus≈• sezen√≠.</div>
      <div id="prompt" style="font-size:1.8rem; font-weight:800; margin:.2rem 0 0"></div>
      <div class="muted" id="promptField"></div>
      <div class="space"></div>
      <div class="row">
        <input id="answer" type="text" placeholder="Sem napi≈° odpovƒõƒè‚Ä¶" disabled />
        <button class="btn" id="checkBtn" disabled>‚úÖ Zkontrolovat</button>
      </div>
      <div class="result" id="result"></div>
      <div class="space"></div>
      <div class="flex">
        <button class="btn secondary" id="revealBtn" disabled>üëÄ Zobrazit ≈ôe≈°en√≠</button>
        <button class="btn" id="nextBtn" disabled>‚û°Ô∏è Dal≈°√≠</button>
      </div>
    </section>

    <section class="card" id="summaryBottom" style="margin-top:1rem">
      <h2>Souhrn</h2>
      <div class="muted">Sezen√≠</div>
      <div class="flex">
        <span class="pill">Spr√°vnƒõ: <strong id="okToday_b">0</strong></span>
        <span class="pill">≈†patnƒõ: <strong id="badToday_b">0</strong></span>
        <span class="pill">Zb√Ωv√°: <strong id="leftToday_b">0</strong></span>
      </div>
      <div class="space"></div>
      <div class="muted">Celkem</div>
      <div class="flex">
        <span class="pill">Pokusy: <strong id="attemptsAll_b">0</strong></span>
        <span class="pill">√öspƒõ≈°nost: <strong id="accuracyAll_b">0%</strong></span>
      </div>
    </section>
  </main>

  <script>
    const DEFAULT_DATA_URL = 'slovicka.csv';

    // ===== Stav & util =====
    const KEY_STATS = 'vt_stats_v3';
    const KEY_SETTINGS = 'vt_settings_v3';

    let WORDS = [];           // {en, cs, lesson}
    let LESSONS = [];         // nap≈ô. [1,2,3]

    const norm = (s) => (s||'').toString().normalize('NFD').replace(/\p{Diacritic}/gu,'').toLowerCase().trim();
    const uidOf = (w) => `${w.en}__${w.cs}`;
    const loadJSON = (k,d)=>{ try{return JSON.parse(localStorage.getItem(k)) ?? d;}catch{return d;} };
    const saveJSON = (k,v)=> localStorage.setItem(k, JSON.stringify(v));

    let stats = loadJSON(KEY_STATS, {}); // uid -> {ok,bad}
    let settings = loadJSON(KEY_SETTINGS, {direction:'en-cs', mode:'random', theme:'dark', lessons:[], target:20, timed:false, timeMin:10});

    // ===== UI prvky =====
    const directionEl = document.getElementById('direction');
    const modeEl = document.getElementById('mode');
    const lessonsBox = document.getElementById('lessonsBox');
    const selectAllBtn = document.getElementById('selectAllBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');

    const targetCountEl = document.getElementById('targetCount');
    const timedEl = document.getElementById('timed');
    const timeLimitEl = document.getElementById('timeLimit');

    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const sessionInfoEl = document.getElementById('sessionInfo');
    const timerInfoEl = document.getElementById('timerInfo');

    const promptEl = document.getElementById('prompt');
    const promptFieldEl = document.getElementById('promptField');
    const promptMetaEl = document.getElementById('promptMeta');
    const answerEl = document.getElementById('answer');
    const resultEl = document.getElementById('result');
    const nextBtn = document.getElementById('nextBtn');
    const checkBtn = document.getElementById('checkBtn');
    const revealBtn = document.getElementById('revealBtn');

    const okTodayEl = document.getElementById('okToday');
    const badTodayEl = document.getElementById('badToday');
    const leftTodayEl = document.getElementById('leftToday');
    const attemptsAllEl = document.getElementById('attemptsAll');
    const accuracyAllEl = document.getElementById('accuracyAll');

    const okToday_b = document.getElementById('okToday_b');
    const badToday_b = document.getElementById('badToday_b');
    const leftToday_b = document.getElementById('leftToday_b');
    const attemptsAll_b = document.getElementById('attemptsAll_b');
    const accuracyAll_b = document.getElementById('accuracyAll_b');

    const countInfoEl = document.getElementById('countInfo');
    theFilterInfoEl = document.getElementById('filterInfo');
    const dataInfoEl = document.getElementById('dataInfo');

    const themeBtn = document.getElementById('themeBtn');

    // ===== Motiv =====
    function applyTheme(){ document.documentElement.setAttribute('data-theme', settings.theme||'dark'); }
    themeBtn.addEventListener('click', ()=>{ settings.theme = settings.theme==='light'?'dark':'light'; saveJSON(KEY_SETTINGS, settings); applyTheme(); });

    // ===== CSV naƒç√≠t√°n√≠ =====
    function getDataUrl(){ try{ const u=new URL(location.href); return u.searchParams.get('data') || DEFAULT_DATA_URL; }catch{ return DEFAULT_DATA_URL; } }
    function parseLesson(v){ const m = (v||'').toString().match(/\d+/); return m? parseInt(m[0],10) : 1; }

      function parseCSV(text) {
          const out = [];
          const stripBOM = text.replace(/^\uFEFF/, '');
          const lines = stripBOM.split(/\r?\n/);

          for (const line of lines) {
              const raw = line.trim();
              if (!raw) continue;
              const fields = [];
              let cur = '', inQuotes = false;
              for (let i = 0; i < raw.length; i++) {
                  const ch = raw[i];
                  if (ch === '"') {
                      if (inQuotes && raw[i + 1] === '"') { cur += '"'; i++; }
                      else inQuotes = !inQuotes;
                  } else if (ch === ';' && !inQuotes) {
                      fields.push(cur); cur = '';
                  } else {
                      cur += ch;
                  }
              }
              fields.push(cur);

              const en = (fields[0] || '').trim().replace(/^to\s+/i, ''); // ignoruj √∫vodn√≠ "to "
              const cs = (fields[1] || '').trim();                        // m≈Ø≈æe obsahovat v√≠c v√Ωznam≈Ø oddƒõlen√Ωch ƒç√°rkou
              const lesson = parseLesson(fields[2] || '1');               // 4 / lekce4 / L4 ‚Üí 4

              if (en && cs) out.push({ en, cs, lesson });
          }
          return out;
      }

    async function loadWords(){
      const url = getDataUrl();
      dataInfoEl.textContent = url;
      try{
        const resp = await fetch(url, {cache:'no-store'});
        if(!resp.ok) throw new Error('HTTP '+resp.status);
        const txt = await resp.text();
        WORDS = parseCSV(txt);
      }catch(err){
        console.warn('Nepoda≈ôilo se naƒç√≠st CSV, pou≈æ√≠v√°m vestavƒõn√Ω vzorek.', err);
        dataInfoEl.textContent = 'vestavƒõn√° data';
        WORDS = [
          {en:'police officer', cs:'policista', lesson:1},
          {en:'badge', cs:'slu≈æebn√≠ odznak', lesson:1},
          {en:'crime scene', cs:'m√≠sto ƒçinu', lesson:2},
          {en:'evidence', cs:'d≈Økaz', lesson:2},
          {en:'breathalyzer', cs:'alkoholtester', lesson:3},
          {en:"driver's licence", cs:'≈ôidiƒçsk√Ω pr≈Økaz', lesson:3}
        ];
      }
      LESSONS = Array.from(new Set(WORDS.map(w=>w.lesson))).sort((a,b)=>a-b);
      if(!settings.lessons.length){ settings.lessons = LESSONS.slice(); saveJSON(KEY_SETTINGS, settings); }
      else { settings.lessons = settings.lessons.filter(x=> LESSONS.includes(x)); saveJSON(KEY_SETTINGS, settings); }
    }

    // ===== Lekce (checkboxy) =====
    function renderLessons(){
      lessonsBox.innerHTML='';
      LESSONS.forEach(i=>{
        const id = 'lesson_'+i;
        const wrap = document.createElement('label');
        wrap.style.display='flex'; wrap.style.gap='.4rem'; wrap.style.alignItems='center'; wrap.style.justifyContent='center';
        wrap.innerHTML = `<input type="checkbox" id="${id}" value="${i}"> <span>L${i}</span>`;
        const cb = wrap.querySelector('input');
        cb.checked = settings.lessons.includes(i);
        cb.addEventListener('change', ()=>{
          if(cb.checked){ if(!settings.lessons.includes(i)) settings.lessons.push(i); }
          else { settings.lessons = settings.lessons.filter(x=>x!==i); }
          saveJSON(KEY_SETTINGS, settings); refreshCounts();
        });
        lessonsBox.appendChild(wrap);
      });
    }
    selectAllBtn.addEventListener('click', ()=>{ settings.lessons = LESSONS.slice(); saveJSON(KEY_SETTINGS, settings); renderLessons(); refreshCounts(); });
    clearAllBtn.addEventListener('click', ()=>{ settings.lessons = []; saveJSON(KEY_SETTINGS, settings); renderLessons(); refreshCounts(); });

    // ===== V√Ωbƒõr & filtrace =====
    function filteredWords(){ return WORDS.filter(w=> settings.lessons.includes(w.lesson)); }

    // ===== Statistika =====
    function ensureStat(w){ const id = uidOf(w); stats[id] = stats[id]||{ok:0,bad:0}; return stats[id]; }
    function totalStats(){ let ok=0,bad=0; Object.values(stats).forEach(x=>{ ok+=x.ok||0; bad+=x.bad||0; }); const attempts=ok+bad; const acc = attempts? Math.round(ok*100/attempts):0; return {ok,bad,attempts,acc}; }
    function updateTotalsUI(){
      const t = totalStats();
      attemptsAllEl.textContent = t.attempts; accuracyAllEl.textContent = t.acc + '%';
      attemptsAll_b.textContent = t.attempts; accuracyAll_b.textContent = t.acc + '%';
    }

    // ===== Sezen√≠ =====
    let session = {active:false, target:20, left:0, ok:0, bad:0, timed:false, deadline:null, timerId:null};
    let current = null; // {w, ask, expect, dir}

    function setPracticeEnabled(on){
      [answerEl, checkBtn, revealBtn, nextBtn].forEach(el=>{ el.disabled = !on; });
      document.getElementById('summaryTop').classList.toggle('dim', !on);
      document.getElementById('summaryTop').setAttribute('aria-hidden', String(!on));
    }

    function startSession(){
      const pool = filteredWords();
      if(!pool.length){ alert('Vyber alespo≈à jednu lekci.'); return; }
      session.active = true;
      session.target = Math.max(1, parseInt(targetCountEl.value||'20',10));
      session.left = session.target;
      session.ok = 0; session.bad = 0;
      session.timed = !!timedEl.checked;
      if(session.timerId){ clearInterval(session.timerId); session.timerId=null; }
      if(session.timed){
        const mins = Math.max(1, parseInt(timeLimitEl.value||'10',10));
        session.deadline = Date.now() + mins*60*1000;
        timerInfoEl.hidden = false;
        session.timerId = setInterval(()=>{
          const remain = Math.max(0, session.deadline - Date.now());
          const mm = String(Math.floor(remain/60000)).padStart(2,'0');
          const ss = String(Math.floor((remain%60000)/1000)).padStart(2,'0');
          timerInfoEl.textContent = `‚è± ${mm}:${ss}`;
          if(remain<=0){ endSession('ƒåas vypr≈°el.'); }
        }, 200);
      } else { timerInfoEl.hidden = true; }

      sessionInfoEl.textContent = `Bƒõ≈æ√≠ ‚Äì c√≠l ${session.target}`;
      okTodayEl.textContent = '0'; badTodayEl.textContent = '0'; leftTodayEl.textContent = String(session.left);
      okToday_b.textContent = '0'; badToday_b.textContent = '0'; leftToday_b.textContent = String(session.left);
      resultEl.textContent=''; resultEl.className='result';
      setPracticeEnabled(true);
      pickNext();
    }

    function endSession(msg){
      if(!session.active) return;
      session.active = false;
      setPracticeEnabled(false);
      if(session.timerId){ clearInterval(session.timerId); session.timerId=null; }
      timerInfoEl.hidden = true;
      sessionInfoEl.textContent = 'Neaktivn√≠';
      promptMetaEl.textContent = msg || 'Sezen√≠ ukonƒçeno.';
    }

    function resetSession(){ endSession('Resetov√°no.'); promptEl.textContent=''; promptFieldEl.textContent=''; answerEl.value=''; resultEl.textContent=''; }

    startBtn.addEventListener('click', startSession);
    resetBtn.addEventListener('click', resetSession);

    // ===== V√Ωbƒõr dal≈°√≠ho slova =====
    function chooseWord(){
      const pool = filteredWords();
      if(!pool.length) return null;
      const m = modeEl.value;
      if(m==='random') return pool[Math.floor(Math.random()*pool.length)];
      const arr = pool.slice().sort((a,b)=>{
        const sa = stats[uidOf(a)]||{ok:0,bad:0};
        const sb = stats[uidOf(b)]||{ok:0,bad:0};
        const wa = (sa.bad||0) - (sa.ok||0);
        const wb = (sb.bad||0) - (sb.ok||0);
        return wb - wa;
      });
      const k = Math.max(3, Math.ceil(arr.length*0.3));
      return arr[Math.floor(Math.random()*k)];
    }

    function pickNext(){
      if(!session.active){ promptMetaEl.textContent='Vyber lekce a spus≈• sezen√≠.'; return; }
      if(session.left<=0){ endSession('Hotovo ‚Äì splnƒõn c√≠lov√Ω poƒçet slov.'); return; }
      resultEl.textContent=''; resultEl.className='result'; answerEl.value='';
      const w = chooseWord();
      if(!w){ promptEl.textContent='(≈Ω√°dn√° slova)'; promptFieldEl.textContent=''; return; }
      const dir = directionEl.value==='mix' ? (Math.random()<0.5?'en-cs':'cs-en') : directionEl.value;
      const ask = dir==='en-cs' ? w.en : w.cs;
      const expect = dir==='en-cs' ? w.cs : w.en;
      current = {w, ask, expect, dir};
      promptEl.textContent = ask;
      promptFieldEl.textContent = `Lekce: ${w.lesson}`;
      promptMetaEl.textContent = `C√≠l: ${session.target} ‚Ä¢ Zb√Ωv√°: ${session.left}`;
      answerEl.focus();
      // po vyps√°n√≠ p≈ô√≠kladu odeƒçteme zb√Ωvaj√≠c√≠ poƒçet
      session.left--; leftTodayEl.textContent = String(session.left); leftToday_b.textContent = String(session.left);
    }

    // ===== Kontrola =====
    function ensureStat(w){ const id = uidOf(w); stats[id] = stats[id]||{ok:0,bad:0}; return stats[id]; }
    function check() {
        function stripParens(s) {
              let out = '', depth = 0;
              for (const ch of String(s)) {
                  if (ch === '(' || ch === '[') { depth++; continue; }
                  if (ch === ')' || ch === ']') { if (depth > 0) depth--; continue; }
                  if (depth === 0) out += ch;
              }
              return out;
          }
          function cleanDashesSpaces(s) {
              let t = '';
              for (const ch of String(s)) {
                  if (ch === '-' || ch === '‚Äì' || ch === '‚Äî') t += ' ';
                  else t += ch;
              }
              const parts = t.split(' ');
              const acc = []; for (const p of parts) { if (p) acc.push(p); }
              return acc.join(' ').trim();
          }
          function variantsOf(text) {
              if (text == null) return [];
              let cleaned = stripParens(String(text));
              let tmp = cleaned;
              [';', '/', '|'].forEach(sep => { tmp = tmp.split(sep).join(','); });
              tmp = tmp.replace(' nebo ', ',').replace(' NEBO ', ',').replace(' Nebo ', ',');
              const rawParts = tmp.split(',');
              const parts = [];
              for (let p of rawParts) {
                  p = cleanDashesSpaces(p);
                  if (!p) continue;
                  const lower = p.toLowerCase();
                  if (lower.startsWith('to ')) p = p.slice(3);
                  p = cleanDashesSpaces(p);
                  if (p) parts.push(norm(p));
              }
              const uniq = Array.from(new Set(parts)).filter(Boolean);
              if (uniq.length === 0) {
                  const single = cleanDashesSpaces(String(text));
                  if (single) return [norm(single)];
              }
              return uniq;
          }
          if (!current || !session.active) return;
          let userRaw = cleanDashesSpaces(answerEl.value || '');
          if (!userRaw) { resultEl.textContent = 'Zadej odpovƒõƒè.'; resultEl.className = 'result warn'; return; }
          const lower = userRaw.toLowerCase();
          if (lower.startsWith('to ')) userRaw = userRaw.slice(3);
          const user = norm(userRaw);
          const s = ensureStat(current.w);
          const variants = variantsOf(current.expect);
          const ok = variants.includes(user);
          if (ok) { s.ok++; session.ok++; resultEl.textContent = 'Spr√°vnƒõ!'; resultEl.className = 'result good'; current = null; setTimeout(() => { if (session.active) { pickNext(); } }, 700); }
          else { s.bad++; session.bad++; resultEl.innerHTML = `≈†patnƒõ. Spr√°vnƒõ: <strong>${current.expect}</strong>`; resultEl.className = 'result bad'; }
          saveJSON(KEY_STATS, stats);
          okTodayEl.textContent = String(session.ok); badTodayEl.textContent = String(session.bad);
          okToday_b.textContent = String(session.ok); badToday_b.textContent = String(session.bad);
          updateTotalsUI();
      }

    checkBtn.addEventListener('click', check);
    answerEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ check(); }});
    revealBtn.addEventListener('click', ()=>{ if(current){ resultEl.innerHTML = `≈òe≈°en√≠: <strong>${current.expect}</strong>`; resultEl.className='result'; }});
    nextBtn.addEventListener('click', pickNext);

    // ===== Nastaven√≠ p≈ôenos do state =====
    directionEl.addEventListener('change', ()=>{ settings.direction = directionEl.value; saveJSON(KEY_SETTINGS, settings); });
    modeEl.addEventListener('change', ()=>{ settings.mode = modeEl.value; saveJSON(KEY_SETTINGS, settings); });
    targetCountEl.addEventListener('change', ()=>{ settings.target = Math.max(1, parseInt(targetCountEl.value||'20',10)); saveJSON(KEY_SETTINGS, settings); });
    timedEl.addEventListener('change', ()=>{ settings.timed = !!timedEl.checked; saveJSON(KEY_SETTINGS, settings); });
    timeLimitEl.addEventListener('change', ()=>{ settings.timeMin = Math.max(1, parseInt(timeLimitEl.value||'10',10)); saveJSON(KEY_SETTINGS, settings); });

    // ===== P≈ôehled poƒçt≈Ø =====
    function refreshCounts(){
      countInfoEl.textContent = `${WORDS.length} slov`;
      filterInfoEl.textContent = `${filteredWords().length} vybr√°no`;
    }

    // ===== Inicializace =====
    async function init(){
      applyTheme();
      directionEl.value = settings.direction;
      modeEl.value = settings.mode;
      targetCountEl.value = settings.target;
      timedEl.checked = settings.timed; timeLimitEl.value = settings.timeMin;
      await loadWords();
      renderLessons();
      refreshCounts();
      updateTotalsUI();
      setPracticeEnabled(false);
    }
    init();
  </script>
</body>
</html>
