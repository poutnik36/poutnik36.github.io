<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Angliƒçtina pro policejn√≠ praxi ‚Äì Opakov√°n√≠ slov√≠ƒçek</title>
  <meta name="description" content="Lehk√° webov√° aplikace pro opakov√°n√≠ anglick√Ωch slov√≠ƒçek podle lekc√≠. Naƒç√≠t√° slov√≠ƒçka z CSV, prvn√≠ ≈ô√°dek CSV obsahuje n√°zvy lekc√≠." />
  <style>
    :root{
      --bg:#0b1020; --card:#121832; --text:#e8eefc; --muted:#9aa6c8; --acc:#7aa2ff; --border:#243055; --good:#16a34a; --bad:#ef4444; --warn:#f59e0b;
    }
    [data-theme="light"]{
      --bg:#f8fafc; --card:#ffffff; --text:#0b1020; --muted:#475569; --acc:#1d4ed8; --border:#e2e8f0; --good:#16a34a; --bad:#b91c1c; --warn:#b45309;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:var(--bg); color:var(--text)}
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.2) blur(8px); background:color-mix(in oklab, var(--bg) 85%, transparent); border-bottom:1px solid var(--border)}
    .wrap{max-width:1100px; margin-inline:auto; padding:1rem}
    nav{display:flex; align-items:center; justify-content:space-between}
    .btn{display:inline-flex; align-items:center; gap:.5rem; padding:.55rem .9rem; border:1px solid var(--border); background:var(--card); color:var(--text); border-radius:.8rem; cursor:pointer}
    .btn:hover{transform:translateY(-1px)}
    .btn.secondary{background:transparent}
    .grid{display:grid; gap:1rem}
    @media(min-width:1000px){.grid{grid-template-columns:1.2fr 1fr}}
    .card{background:var(--card); border:1px solid var(--border); border-radius:1rem; padding:1rem}
    h2{margin:0 0 .5rem; font-size:1.25rem}
    label{display:block; font-weight:600; margin:.4rem 0 .2rem}
    input[type="text"], input[type="number"], select{width:100%; padding:.6rem .7rem; border-radius:.6rem; border:1px solid var(--border); background:var(--bg); color:var(--text)}
    .row{display:flex; gap:.5rem; align-items:center}
    .row.wrap{flex-wrap:wrap}
    .row > *{flex:1}
    .pill{border:1px solid var(--border); border-radius:999px; padding:.2rem .6rem; color:var(--muted); font-size:.85rem}
    .muted{color:var(--muted)}
    .result{margin-top:.6rem; font-weight:700}
    .good{color:var(--good)}
    .bad{color:var(--bad)}
    .warn{color:var(--warn)}
    .flex{display:flex; gap:.6rem; align-items:center; flex-wrap:wrap}
    .space{height:1rem}
    .badge{display:inline-flex; gap:.35rem; align-items:center; padding:.2rem .5rem; border:1px solid var(--border); border-radius:.6rem; font-size:.85rem; color:var(--muted)}

    /* Lekce ‚Äì svisl√Ω seznam kv≈Øli dlouh√Ωm n√°zv≈Øm */
    .checkboxes{display:flex; flex-direction:column; gap:.4rem}
    .checkboxes label{display:flex; gap:.6rem; align-items:flex-start}
    .checkboxes input{margin-top:.2rem}

    /* Tr√©nink ‚Äì dvƒõ karty vedle sebe */
    .pairgrid{display:grid; gap:.8rem}
    @media(min-width:900px){ .pairgrid{ grid-template-columns:1fr 1fr; } }
    .innercard{background:color-mix(in oklab, var(--card) 92%, var(--acc) 8%); border:1px dashed var(--border); border-radius:.8rem; padding:1rem; min-height:140px; display:flex; align-items:center; justify-content:center}
    #prompt{font-size:1.8rem; font-weight:800; text-align:center}

    /* ‚ÄûPsan√≠ p≈ô√≠mo do karty‚Äú */
    .fakeinputwrap{display:flex; align-items:center; justify-content:center; width:100%}
    #answer{background:transparent; border:none; outline:none; width:100%; font-size:1.6rem; text-align:center; color:var(--text)}
    #answer::placeholder{color:color-mix(in oklab, var(--muted) 70%, transparent)}

    .btnrow{display:flex; gap:.6rem; flex-wrap:wrap; justify-content:center; margin-top:.6rem}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <nav>
        <div class="flex">
          <strong>üîÅ Opakov√°n√≠ slov√≠ƒçek</strong>
          <span class="pill" id="countInfo">0 slov</span>
          <span class="pill" id="filterInfo" title="Filtrovan√Ω poƒçet">0 vybr√°no</span>
          <span class="pill" id="dataInfo" title="Zdroj dat">CSV</span>
        </div>
        <div class="flex">
          <button class="btn secondary" id="themeBtn" title="Svƒõtl√Ω/tmav√Ω re≈æim">üåì Motiv</button>
        </div>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="grid" id="top">
      <div class="card" id="settings">
        <h2>Nastaven√≠</h2>
        <div class="row">
          <div>
            <label for="direction">Smƒõr</label>
            <select id="direction">
              <option value="en-cs">EN ‚Üí CZ</option>
              <option value="cs-en">CZ ‚Üí EN</option>
              <option value="mix">Mix</option>
            </select>
          </div>
          <div>
            <label for="mode">Re≈æim</label>
            <select id="mode">
              <option value="random">N√°hodnƒõ</option>
              <option value="weak">Up≈ôednostnit slab√°</option>
            </select>
          </div>
        </div>

        <div class="space"></div>
        <label>Lekce</label>
        <div class="checkboxes" id="lessonsBox" aria-label="V√Ωbƒõr lekc√≠"></div>
        <div class="row" style="margin-top:.4rem">
          <button class="btn secondary" id="selectAllBtn">Vybrat v≈°e</button>
          <button class="btn secondary" id="clearAllBtn">Zru≈°it v≈°e</button>
        </div>

        <div class="space"></div>
        <div class="row">
          <div>
            <label for="targetCount">Poƒçet slov√≠ƒçek (c√≠l sezen√≠)</label>
            <input id="targetCount" type="number" min="1" step="1" value="20" />
          </div>
          <div>
            <label class="row" style="gap:.6rem"><input id="timed" type="checkbox" /> Uƒçen√≠ na ƒças</label>
            <div class="row">
              <input id="timeLimit" type="number" min="1" step="1" value="10" />
              <span class="badge">min</span>
            </div>
          </div>
        </div>

        <div class="space"></div>
        <div class="flex">
          <button class="btn" id="startBtn"‚ñ∂Ô∏è Start</button>
          <button class="btn secondary" id="resetBtn">‚Ü∫ Reset</button>
          <span class="badge" id="sessionInfo">Neaktivn√≠</span>
          <span class="badge" id="timerInfo" hidden>‚è± 00:00</span>
        </div>
      </div>

      <!-- Panely Souhrn byly na p≈ô√°n√≠ odstranƒõny -->
    </section>

    <section class="card" id="practice" style="margin-top:1rem">
      <h2>Tr√©nink</h2>
      <div class="muted" id="promptMeta">Vyber lekce a spus≈• sezen√≠.</div>

      <div class="pairgrid" style="margin-top:.6rem">
        <div class="innercard" id="promptCard">
          <div id="prompt"></div>
        </div>
        <div class="innercard" id="answerCard">
          <div class="fakeinputwrap"><input id="answer" type="text" placeholder="Sem napi≈° odpovƒõƒè‚Ä¶" disabled /></div>
          <div class="btnrow">
            <button class="btn" id="checkBtn" disabled>‚úÖ Zkontrolovat</button>
            <button class="btn secondary" id="dontKnowBtn" disabled>ü§∑‚Äç‚ôÇÔ∏è Nev√≠m</button>
            <button class="btn secondary" id="hintBtn" disabled>üí° N√°povƒõda</button>
          </div>
        </div>
      </div>

      <div class="result" id="result"></div>
    </section>
  </main>

  <script>
    // ===== Konfigurace CSV =====
    // 1. ≈ô√°dek: n√°zvy lekc√≠ oddƒõlen√© st≈ôedn√≠kem
    // dal≈°√≠ ≈ô√°dky: angliƒçtina;ƒçe≈°tina;ƒç√≠slo_lekce
    const DEFAULT_DATA_URL = 'slovicka.csv';

    // ===== Stav & util =====
    const KEY_STATS = 'vt_stats_v4';
    const KEY_SETTINGS = 'vt_settings_v4';

    let WORDS = [];                 // {en, cs, lesson}
    let LESSONS = [];               // [1,2,...]
    let LESSON_TITLES = [];         // index 0 -> lekce 1

    const norm = (s) => (s||'').toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim();
    const uidOf = (w) => `${w.en}__${w.cs}`;
    const loadJSON = (k,d)=>{ try{return JSON.parse(localStorage.getItem(k)) ?? d;}catch{return d;} };
    const saveJSON = (k,v)=> localStorage.setItem(k, JSON.stringify(v));

    let stats = loadJSON(KEY_STATS, {}); // uid -> {ok,bad}
    let settings = loadJSON(KEY_SETTINGS, {direction:'en-cs', mode:'random', theme:'dark', lessons:[], target:20, timed:false, timeMin:10});

    // ===== UI prvky =====
    const directionEl = document.getElementById('direction');
    const modeEl = document.getElementById('mode');
    const lessonsBox = document.getElementById('lessonsBox');
    const selectAllBtn = document.getElementById('selectAllBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');

    const targetCountEl = document.getElementById('targetCount');
    const timedEl = document.getElementById('timed');
    const timeLimitEl = document.getElementById('timeLimit');

    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const sessionInfoEl = document.getElementById('sessionInfo');
    const timerInfoEl = document.getElementById('timerInfo');

    const promptEl = document.getElementById('prompt');
    const promptMetaEl = document.getElementById('promptMeta');
    const answerEl = document.getElementById('answer');
    const resultEl = document.getElementById('result');
    const checkBtn = document.getElementById('checkBtn');
    const dontKnowBtn = document.getElementById('dontKnowBtn');
    const hintBtn = document.getElementById('hintBtn');

    const countInfoEl = document.getElementById('countInfo');
    const filterInfoEl = document.getElementById('filterInfo');
    const dataInfoEl = document.getElementById('dataInfo');

    const themeBtn = document.getElementById('themeBtn');

    // ===== Motiv =====
    function applyTheme(){ document.documentElement.setAttribute('data-theme', settings.theme||'dark'); }
    themeBtn.addEventListener('click', ()=>{ settings.theme = settings.theme==='light'?'dark':'light'; saveJSON(KEY_SETTINGS, settings); applyTheme(); });

    // ===== CSV naƒç√≠t√°n√≠ a parsov√°n√≠ =====
    function getDataUrl(){ try{ const u=new URL(location.href); return u.searchParams.get('data') || DEFAULT_DATA_URL; }catch{ return DEFAULT_DATA_URL; } }
    function parseLesson(v){ const m = (v||'').toString().match(/\d+/); return m? parseInt(m[0],10) : 1; }

    function splitCsvSemicolons(line){
      const out=[]; let cur=''; let inQ=false; for(let i=0;i<line.length;i++){
        const ch=line[i];
        if(ch==='"'){
          if(inQ && line[i+1]==='"'){ cur+='"'; i++; }
          else inQ=!inQ;
        }else if(ch===';' && !inQ){ out.push(cur); cur=''; }
        else cur+=ch;
      }
      out.push(cur); return out;
    }

    function stripBOM(s){ return s && s.charCodeAt(0)===0xFEFF ? s.slice(1) : s; }

    function parseCSVWithTitles(text){
      const lines = stripBOM(text).split(/\r?\n/).map(l=>l.trim());
      let idx=0; while(idx<lines.length && !lines[idx]) idx++; // prvn√≠ nepr√°zdn√Ω ≈ô√°dek = tituly
      const titles = idx<lines.length ? splitCsvSemicolons(lines[idx]).map(s=>s.trim()).filter(Boolean) : [];
      const words=[];
      for(let i=idx+1;i<lines.length;i++){
        const raw=lines[i]; if(!raw) continue;
        const f = splitCsvSemicolons(raw);
        const en = (f[0]||'').trim().replace(/^to\s+/i,''); // odstra≈à ‚Äûto ‚Äú na zaƒç√°tku
        const cs = (f[1]||'').trim();                      // m≈Ø≈æe m√≠t v√≠c v√Ωznam≈Ø oddƒõlen√Ωch ƒç√°rkou
        const lesson = parseLesson(f[2]||'1');
        if(en && cs) words.push({en, cs, lesson});
      }
      return {titles, words};
    }

    async function loadWords(){
      const url = getDataUrl();
      dataInfoEl.textContent = url;
      try{
        const resp = await fetch(url, {cache:'no-store'});
        if(!resp.ok) throw new Error('HTTP '+resp.status);
        const txt = await resp.text();
        const parsed = parseCSVWithTitles(txt);
        LESSON_TITLES = parsed.titles;
        WORDS = parsed.words;
      }catch(err){
        console.warn('Naƒçten√≠ CSV selhalo, pou≈æ√≠v√°m vestavƒõn√° demo data.', err);
        dataInfoEl.textContent = 'vestavƒõn√° data';
        LESSON_TITLES = ['Organizational structure of the police','International police cooperation','Initiation of criminal proceedings and pre-trial proceedings','Crime','Organized crime','Public order and security','Traffic security and prevention'];
        WORDS = [
          {en:'police officer', cs:'policista', lesson:1},
          {en:'crime scene', cs:'m√≠sto ƒçinu', lesson:4},
          {en:'breathalyzer', cs:'alkoholtester', lesson:7}
        ];
      }
      const maxLesson = Math.max(0, ...WORDS.map(w=>w.lesson));
      if(LESSON_TITLES.length < maxLesson){
        for(let i=LESSON_TITLES.length;i<maxLesson;i++){ LESSON_TITLES[i] = `Lekce ${i+1}`; }
      }
      LESSONS = Array.from(new Set(WORDS.map(w=>w.lesson))).sort((a,b)=>a-b);
      if(!settings.lessons.length){ settings.lessons = LESSONS.slice(); saveJSON(KEY_SETTINGS, settings); }
      else { settings.lessons = settings.lessons.filter(x=> LESSONS.includes(x)); saveJSON(KEY_SETTINGS, settings); }
    }

    function titleOfLesson(n){ return LESSON_TITLES[n-1] || `Lekce ${n}`; }

    // ===== Lekce (checkboxy ‚Äì pod sebou, s n√°zvy) =====
    function renderLessons(){
      lessonsBox.innerHTML='';
      const maxL = Math.max(LESSON_TITLES.length, ...WORDS.map(w=>w.lesson), 0);
      for(let i=1;i<=maxL;i++){
        const id = 'lesson_'+i;
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" id="${id}" value="${i}"> <span>${titleOfLesson(i)}</span>`;
        const cb = label.querySelector('input');
        cb.checked = settings.lessons.includes(i);
        cb.addEventListener('change', ()=>{
          if(cb.checked){ if(!settings.lessons.includes(i)) settings.lessons.push(i); }
          else { settings.lessons = settings.lessons.filter(x=>x!==i); }
          saveJSON(KEY_SETTINGS, settings); refreshCounts();
        });
        lessonsBox.appendChild(label);
      }
    }
    selectAllBtn.addEventListener('click', ()=>{ const maxL=Math.max(LESSON_TITLES.length, ...WORDS.map(w=>w.lesson), 0); settings.lessons = Array.from({length:maxL}, (_,k)=>k+1); saveJSON(KEY_SETTINGS, settings); renderLessons(); refreshCounts(); });
    clearAllBtn.addEventListener('click', ()=>{ settings.lessons = []; saveJSON(KEY_SETTINGS, settings); renderLessons(); refreshCounts(); });

    // ===== Filtrace =====
    function filteredWords(){ return WORDS.filter(w=> settings.lessons.includes(w.lesson)); }

    // ===== Sezen√≠ =====
    let session = {active:false, target:20, left:0, ok:0, bad:0, timed:false, deadline:null, timerId:null};
    let current = null; // {w, ask, expect, dir, hintTarget}
    let hintIndex = 0;

    function setPracticeEnabled(on){ [answerEl, checkBtn, dontKnowBtn, hintBtn].forEach(el=> el.disabled = !on); }

    function startSession(){
      const pool = filteredWords();
      if(!pool.length){ alert('Vyber alespo≈à jednu lekci.'); return; }
      session.active = true;
      session.target = Math.max(1, parseInt(targetCountEl.value||'20',10));
      session.left = session.target;
      session.ok = 0; session.bad = 0;
      session.timed = !!timedEl.checked;
      if(session.timerId){ clearInterval(session.timerId); session.timerId=null; }
      if(session.timed){
        const mins = Math.max(1, parseInt(timeLimitEl.value||'10',10));
        session.deadline = Date.now() + mins*60*1000;
        timerInfoEl.hidden = false;
        session.timerId = setInterval(()=>{
          const remain = Math.max(0, session.deadline - Date.now());
          const mm = String(Math.floor(remain/60000)).padStart(2,'0');
          const ss = String(Math.floor((remain%60000)/1000)).padStart(2,'0');
          timerInfoEl.textContent = `‚è± ${mm}:${ss}`;
          if(remain<=0){ endSession('ƒåas vypr≈°el.'); }
        }, 200);
      } else { timerInfoEl.hidden = true; }

      sessionInfoEl.textContent = `Bƒõ≈æ√≠ ‚Äì c√≠l ${session.target}`;
      resultEl.textContent=''; resultEl.className='result';
      setPracticeEnabled(true);
      pickNext();
    }

    function endSession(msg){
      if(!session.active) return;
      session.active = false;
      setPracticeEnabled(false);
      if(session.timerId){ clearInterval(session.timerId); session.timerId=null; }
      timerInfoEl.hidden = true;
      sessionInfoEl.textContent = 'Neaktivn√≠';
      promptMetaEl.textContent = msg || 'Sezen√≠ ukonƒçeno.';
    }

    function resetSession(){ endSession('Resetov√°no.'); promptEl.textContent=''; answerEl.value=''; resultEl.textContent=''; }

    startBtn.addEventListener('click', startSession);
    resetBtn.addEventListener('click', resetSession);

    // ===== V√Ωbƒõr dal≈°√≠ho slova =====
    function chooseWord(){
      const pool = filteredWords(); if(!pool.length) return null;
      const m = modeEl.value;
      if(m==='random') return pool[Math.floor(Math.random()*pool.length)];
      const arr = pool.slice().sort((a,b)=>{ const sa = stats[uidOf(a)]||{ok:0,bad:0}; const sb = stats[uidOf(b)]||{ok:0,bad:0}; const wa = (sa.bad||0) - (sa.ok||0); const wb = (sb.bad||0) - (sb.ok||0); return wb - wa; });
      const k = Math.max(3, Math.ceil(arr.length*0.3)); return arr[Math.floor(Math.random()*k)];
    }

    function stripParens(s){ let out='', depth=0; for (const ch of String(s)){ if (ch==='('||ch==='['){ depth++; continue;} if (ch===')'||ch===']'){ if (depth>0) depth--; continue;} if(depth===0) out+=ch; } return out; }
    function cleanDashesSpaces(s){ let t=''; for (const ch of String(s)){ if (ch==='-'||ch==='‚Äì'||ch==='‚Äî') t+=' '; else t+=ch; } return t.split(' ').filter(Boolean).join(' ').trim(); }
    function firstVariantRaw(text){ if(text==null) return ''; let cleaned = stripParens(String(text)); let tmp = cleaned; [';', '|', '/'].forEach(sep=> tmp = tmp.split(sep)[0]);
      const beforeComma = tmp.split(',')[0]; return cleanDashesSpaces(beforeComma); }

    function pickNext(){
      if(!session.active){ promptMetaEl.textContent='Vyber lekce a spus≈• sezen√≠.'; return; }
      if(session.left<=0){ endSession('Hotovo ‚Äì splnƒõn c√≠lov√Ω poƒçet slov.'); return; }
      resultEl.textContent=''; resultEl.className='result'; answerEl.value='';
      const w = chooseWord(); if(!w){ promptEl.textContent='(≈Ω√°dn√° slova)'; return; }
      const dir = directionEl.value==='mix' ? (Math.random()<0.5?'en-cs':'cs-en') : directionEl.value;
      const ask = dir==='en-cs' ? w.en : w.cs;
      const expect = dir==='en-cs' ? w.cs : w.en;
      current = {w, ask, expect, dir, hintTarget: firstVariantRaw(expect)};
      hintIndex = 0;
      promptEl.textContent = ask;
      const lessonTitle = titleOfLesson(w.lesson);
      promptMetaEl.textContent = `C√≠l: ${session.target} ‚Ä¢ Zb√Ωv√°: ${session.left} ‚Ä¢ Spr√°vnƒõ: ${session.ok} ‚Ä¢ ≈†patnƒõ: ${session.bad} ‚Ä¢ Lekce: ${lessonTitle}`;
      answerEl.focus();
      session.left--; refreshCounts();
    }

    // ===== Kontrola + synonyma =====
    function variantsOf(text){
      if (text==null) return [];
      let cleaned = stripParens(String(text));
      let tmp = cleaned; [';', '/', '|'].forEach(sep => { tmp = tmp.split(sep).join(','); });
      tmp = tmp.replace(/\bnebo\b/gi, ',');
      const rawParts = tmp.split(',');
      const parts = [];
      for (let p of rawParts){ p = cleanDashesSpaces(p); if (!p) continue; const lower = p.toLowerCase(); if (lower.startsWith('to ')) p = p.slice(3); p = cleanDashesSpaces(p); if (p) parts.push(norm(p)); }
      const uniq = Array.from(new Set(parts)).filter(Boolean);
      if (uniq.length===0){ const single = cleanDashesSpaces(String(text)); if (single) return [norm(single)]; }
      return uniq;
    }

    function check(){
      if(!current || !session.active) return;
      let userRaw = cleanDashesSpaces(answerEl.value || '');
      if (!userRaw){ resultEl.textContent='Zadej odpovƒõƒè.'; resultEl.className='result warn'; return; }
      const lower = userRaw.toLowerCase(); if (lower.startsWith('to ')) userRaw = userRaw.slice(3);
      const user = norm(userRaw);
      const s = stats[uidOf(current.w)] = stats[uidOf(current.w)]||{ok:0,bad:0};
      const variants = variantsOf(current.expect);
      const ok = variants.includes(user);
      if(ok){ s.ok++; session.ok++; resultEl.textContent='Spr√°vnƒõ!'; resultEl.className='result good'; current=null; setTimeout(()=>{ if(session.active){ pickNext(); } }, 700); }
      else { s.bad++; session.bad++; resultEl.innerHTML = `≈†patnƒõ. Spr√°vnƒõ: <strong>${stripParens(firstVariantRaw(current.expect))}</strong>`; resultEl.className='result bad'; }
      saveJSON(KEY_STATS, stats);
      const lt = current ? titleOfLesson(current.w.lesson) : '';
      promptMetaEl.textContent = `C√≠l: ${session.target} ‚Ä¢ Zb√Ωv√°: ${session.left} ‚Ä¢ Spr√°vnƒõ: ${session.ok} ‚Ä¢ ≈†patnƒõ: ${session.bad}` + (lt?` ‚Ä¢ Lekce: ${lt}`:'');
    }

    checkBtn.addEventListener('click', check);
    answerEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ check(); }});

    // ===== Nev√≠m + N√°povƒõda =====
    dontKnowBtn.addEventListener('click', ()=>{
      if(!current || !session.active) return;
      const fill = firstVariantRaw(current.expect);
      if(fill) answerEl.value = fill; // pouze vypln√≠, nekontroluje
      answerEl.focus();
    });

    hintBtn.addEventListener('click', ()=>{
      if(!current || !session.active) return;
      if(answerEl.value && answerEl.value.trim()!=='') return; // hint funguje jen p≈ôi pr√°zdn√©m poli
      const target = String(current.hintTarget||'');
      if(hintIndex < target.length){
        hintIndex++;
        answerEl.value = target.slice(0, hintIndex);
      }
      answerEl.focus();
    });

    // ===== Nastaven√≠ ‚Üí state =====
    directionEl.addEventListener('change', ()=>{ settings.direction = directionEl.value; saveJSON(KEY_SETTINGS, settings); });
    modeEl.addEventListener('change', ()=>{ settings.mode = modeEl.value; saveJSON(KEY_SETTINGS, settings); });
    targetCountEl.addEventListener('change', ()=>{ settings.target = Math.max(1, parseInt(targetCountEl.value||'20',10)); saveJSON(KEY_SETTINGS, settings); });
    timedEl.addEventListener('change', ()=>{ settings.timed = !!timedEl.checked; saveJSON(KEY_SETTINGS, settings); });
    timeLimitEl.addEventListener('change', ()=>{ settings.timeMin = Math.max(1, parseInt(timeLimitEl.value||'10',10)); saveJSON(KEY_SETTINGS, settings); });

    // ===== Poƒçty naho≈ôe v headeru =====
    function refreshCounts(){
      countInfoEl.textContent = `${WORDS.length} slov`;
      filterInfoEl.textContent = `${filteredWords().length} vybr√°no`;
    }

    // ===== Inicializace =====
    async function init(){
      applyTheme();
      directionEl.value = settings.direction;
      modeEl.value = settings.mode;
      targetCountEl.value = settings.target;
      timedEl.checked = settings.timed; timeLimitEl.value = settings.timeMin;
      await loadWords();
      renderLessons();
      refreshCounts();
      setPracticeEnabled(false);
    }
    init();
  </script>
</body>
</html>
